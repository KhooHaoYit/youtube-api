// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator nestgraphql {
  provider                        = "node node_modules/prisma-nestjs-graphql"
  output                          = "../src/@generated"
  purgeOutput                     = true
  graphqlScalars_BigInt_name      = "GraphQLBigInt"
  graphqlScalars_BigInt_specifier = "graphql-scalars"
}

// TODO: comments

// TODO: clip
// https://www.youtube.com/clip/Ugkxes0UO1XgIY9LlLaisU2a3Le5i8tYkuPe
// https://www.youtube.com/clip/UgkxBQ0tuOU8BR1QJ-O5fimqZ2isMfzFaA-b
// https://www.youtube.com/clip/Ugkx_7XH_e-kdkArvpXV_FIirSfYe_m3ymkl

model CommunityPost {
  id String @id

  content       String?
  replyCount    Int?
  likeCount     Int?
  publishedTime String?
  extra         Json?

  channelId String?
  channel   Channel? @relation(fields: [channelId], references: [id])

  i_createdAt DateTime @default(now())
  i_updatedAt DateTime @updatedAt

  @@index([channelId])
}

model Playlist {
  // TODO: seasoned playlist
  // https://www.youtube.com/playlist?list=PLJ8cMiYb3G5eFOtMi4Ox74bj2hhmL-hdc
  id String @id @unique

  title            String?
  view             Int?
  estimatedCount   Int?
  lastUpdated      String?
  description      String?
  visibility       String?
  unviewableReason String?

  badges          String[]
  videoIds        String[]
  extraChannelIds Json?

  channelId String?
  channel   Channel? @relation(fields: [channelId], references: [id])

  i_createdAt DateTime @default(now())
  i_updatedAt DateTime @updatedAt
}

model Video {
  // TODO: store
  // TODO: fundraiser
  // TODO: chapters
  // https://youtu.be/EwGAcKnE-y4
  // TODO: watch time heatmap
  // TODO: membership tier required
  // https://youtu.be/hURB7goHrYk
  // TODO: video badges (ratings, age restriction)
  // https://youtu.be/XmxZoBLzSSw
  // https://youtu.be/1XOo1OJFAeQ
  id            String      @id @unique
  visibility    Visibility?
  removedReason String?

  title       String?
  description String?

  keywords           String[]
  category           String?
  publishDate        String?
  uploadDate         String?
  liveStartTimestamp DateTime?
  liveEndTimestamp   DateTime?
  viewCount          BigInt?
  duration           Int?

  isLivestream        Boolean?
  isAgeRestricted     Boolean?
  isMembershipContent Boolean?

  channelId String?
  channel   Channel? @relation(fields: [channelId], references: [id])

  i_createdAt DateTime @default(now())
  i_updatedAt DateTime @updatedAt

  @@index([channelId])
}

enum Visibility {
  public
  unlisted
  private
  deleted
  removed
}

model Channel {
  id String @unique

  name        String?
  handle      String?
  avatarUrl   String?
  bannerUrl   String?
  description String?
  location    String?
  joinedAt    String?
  artistBio   String?

  viewCount       BigInt?
  subscriberCount Int?

  verified              Boolean?
  haveBusinessEmail     Boolean?
  haveMembershipFeature Boolean?

  releases         String[]
  featuredDisplay  Json?
  playlistsDisplay Json?
  // gone??
  channels         Json?
  links            Json?
  membershipOffers Json?
  membershipBadges Json?

  videos         Video[]
  playlists      Playlist[]
  communityPosts CommunityPost[]

  i_createdAt DateTime @default(now())
  i_updatedAt DateTime @updatedAt
}
